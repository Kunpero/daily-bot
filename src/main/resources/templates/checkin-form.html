<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit} ? 'Edit Check-In - Daily Bot' : 'Create Check-In - Daily Bot'">Create Check-In - Daily Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .main-content {
            padding: 2rem 0;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: none;
        }
        .card-header {
            background: linear-gradient(135deg, #4A154B 0%, #3a0f3a 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            border: none;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4A154B 0%, #3a0f3a 100%);
            border: none;
            border-radius: 8px;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #3a0f3a 0%, #2a0b2a 100%);
            transform: translateY(-1px);
        }
        .btn-secondary {
            border-radius: 8px;
        }
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .form-control:focus, .form-select:focus {
            border-color: #4A154B;
            box-shadow: 0 0 0 0.2rem rgba(74, 21, 75, 0.25);
        }
        .alert {
            border-radius: 10px;
            border: none;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        .character-count {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .character-count.warning {
            color: #fd7e14;
        }
        .character-count.danger {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fab fa-slack me-2"></i>
                Daily Bot
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/checkin">
                    <i class="fas fa-arrow-left me-1"></i>
                    Back to Check-Ins
                </a>
                <a class="nav-link" href="/logout">
                    <i class="fas fa-sign-out-alt me-1"></i>
                    Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Success/Error Messages -->
                <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle me-2"></i>
                    <span th:text="${successMessage}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                
                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span th:text="${errorMessage}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Form Card -->
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="fas fa-edit me-2"></i>
                            <span th:text="${isEdit} ? 'Edit Check-In' : 'Create New Check-In'">Create New Check-In</span>
                        </h4>
                    </div>
                    <div class="card-body">
                        <form th:action="${isEdit} ? @{/checkin/{uuid}/edit(uuid=${checkIn.uuid})} : @{/checkin/create}"
                              th:object="${checkIn}" method="post">
                            
                            <!-- Name Field -->
                            <div class="mb-4">
                                <label for="name" class="form-label">
                                    <i class="fas fa-tag me-1"></i>
                                    Check-In Name <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="name" name="name" 
                                       th:field="*{name}" 
                                       placeholder="Enter a name for this check-in session..."
                                       maxlength="100" required>
                                <div class="character-count mt-1">
                                    <span id="nameCount">0</span>/100 characters
                                </div>
                            </div>
                            
                            <!-- Intro Message -->
                            <div class="mb-4">
                                <label for="introMessage" class="form-label">
                                    <i class="fas fa-comment-dots me-1"></i>
                                    Intro Message
                                </label>
                                <textarea class="form-control" id="introMessage" name="introMessage" 
                                          th:field="*{introMessage}" rows="4" 
                                          placeholder="Enter the introduction message for the check-in session..."
                                          maxlength="1000"></textarea>
                                <div class="character-count mt-1">
                                    <span id="introCount">0</span>/1000 characters
                                </div>
                            </div>

                            <!-- Outro Message -->
                            <div class="mb-4">
                                <label for="outroMessage" class="form-label">
                                    <i class="fas fa-comment-dots me-1"></i>
                                    Outro Message
                                </label>
                                <textarea class="form-control" id="outroMessage" name="outroMessage" 
                                          th:field="*{outroMessage}" rows="4" 
                                          placeholder="Enter the conclusion message for the check-in session..."
                                          maxlength="1000"></textarea>
                                <div class="character-count mt-1">
                                    <span id="outroCount">0</span>/1000 characters
                                </div>
                            </div>

                            <!-- Help Text -->
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Tips:</strong>
                                <ul class="mb-0 mt-2">
                                    <li><strong>Name is required</strong> - Choose a descriptive name for your check-in session</li>
                                    <li>Both intro and outro messages are optional</li>
                                    <li>Use intro messages to welcome participants and set expectations</li>
                                    <li>Use outro messages to thank participants and provide next steps</li>
                                    <li>Messages support basic formatting and can include emojis</li>
                                </ul>
                            </div>

                            <!-- Form Actions -->
                            <div class="d-flex justify-content-between">
                                <a href="/checkin" class="btn btn-secondary">
                                    <i class="fas fa-times me-1"></i>
                                    Cancel
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>
                                    <span th:text="${isEdit} ? 'Update Check-In' : 'Create Check-In'">Create Check-In</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Preview Card -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-eye me-2"></i>
                            Live Preview
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="previewContent">
                            <div class="text-muted text-center">
                                <i class="fas fa-eye-slash fa-2x mb-2"></i>
                                <p>Start typing to see a preview of your check-in messages</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Character count functionality
        function updateCharacterCount(textareaId, countId) {
            const textarea = document.getElementById(textareaId);
            const countElement = document.getElementById(countId);
            
            function updateCount() {
                const count = textarea.value.length;
                countElement.textContent = count;
                
                // Update color based on count
                countElement.className = 'character-count mt-1';
                if (count > 800) {
                    countElement.classList.add('danger');
                } else if (count > 600) {
                    countElement.classList.add('warning');
                }
            }
            
            textarea.addEventListener('input', updateCount);
            updateCount(); // Initial count
        }

        // Live preview functionality
        function updatePreview() {
            const name = document.getElementById('name').value;
            const introMessage = document.getElementById('introMessage').value;
            const outroMessage = document.getElementById('outroMessage').value;
            const previewContent = document.getElementById('previewContent');
            
            if (!name && !introMessage && !outroMessage) {
                previewContent.innerHTML = `
                    <div class="text-muted text-center">
                        <i class="fas fa-eye-slash fa-2x mb-2"></i>
                        <p>Start typing to see a preview of your check-in</p>
                    </div>
                `;
                return;
            }
            
            let previewHtml = '<div class="checkin-preview">';
            
            if (name) {
                previewHtml += `
                    <div class="mb-3">
                        <h5 class="text-primary">
                            <i class="fas fa-tag me-1"></i>
                            ${name}
                        </h5>
                    </div>
                `;
            }
            
            if (introMessage) {
                previewHtml += `
                    <div class="mb-3">
                        <h6 class="text-success">
                            <i class="fas fa-play-circle me-1"></i>
                            Introduction Message
                        </h6>
                        <div class="bg-light p-3 rounded">
                            <p class="mb-0">${introMessage.replace(/\n/g, '<br>')}</p>
                        </div>
                    </div>
                `;
            }
            
            if (outroMessage) {
                previewHtml += `
                    <div class="mb-3">
                        <h6 class="text-info">
                            <i class="fas fa-stop-circle me-1"></i>
                            Conclusion Message
                        </h6>
                        <div class="bg-light p-3 rounded">
                            <p class="mb-0">${outroMessage.replace(/\n/g, '<br>')}</p>
                        </div>
                    </div>
                `;
            }
            
            previewHtml += '</div>';
            previewContent.innerHTML = previewHtml;
        }

        // Initialize character counts
        updateCharacterCount('name', 'nameCount');
        updateCharacterCount('introMessage', 'introCount');
        updateCharacterCount('outroMessage', 'outroCount');

        // Initialize preview
        updatePreview();

        // Add event listeners for live preview
        document.getElementById('name').addEventListener('input', updatePreview);
        document.getElementById('introMessage').addEventListener('input', updatePreview);
        document.getElementById('outroMessage').addEventListener('input', updatePreview);
    </script>
</body>
</html>